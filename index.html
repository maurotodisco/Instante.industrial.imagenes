<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cat√°logo Instante Industrial</title>
<style>
  body {
    font-family: "Poppins", sans-serif;
    margin: 0;
    background: #f6f6f6;
    color: #222;
  }
  header {
    background: #111;
    color: #fff;
    padding: 1rem;
    text-align: center;
    font-size: 1.4rem;
    letter-spacing: 1px;
  }
  main {
    padding: 1rem;
  }
  .material {
    background: white;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .material h2 {
    margin-top: 0;
    font-size: 1.3rem;
    color: #444;
  }
  .carousel {
    display: flex;
    overflow-x: auto;
    gap: 10px;
    scroll-behavior: smooth;
    margin-top: 0.5rem;
  }
  .carousel img {
    height: 160px;
    border-radius: 10px;
    flex: 0 0 auto;
  }
  #editor {
    display: none;
    background: #fff;
    padding: 1rem;
    border-radius: 10px;
    margin-bottom: 1rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  select, input, textarea, button {
    width: 100%;
    margin-top: 6px;
    margin-bottom: 10px;
    padding: 8px;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  button {
    background: #222;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background: #333;
  }
</style>
</head>
<body>
  <header>Cat√°logo Instante.Industrial</header>
  <main>
    <div id="catalogo"></div>

    <button onclick="toggleEditor()">üõ†Ô∏è Editar cat√°logo</button>

    <div id="editor">
      <h3>Editor de materiales</h3>
      <label>Seleccionar material existente:</label>
      <select id="materialSelect"></select>

      <label>Nombre del material:</label>
      <input type="text" id="nombreMaterial">

      <label>Descripci√≥n:</label>
      <textarea id="descripcion" rows="3"></textarea>

      <label>Seleccionar im√°genes del repositorio (Ctrl o Shift para varias):</label>
      <select id="imagenSelect" multiple size="6"></select>

      <button onclick="guardarCambios()">üíæ Guardar cambios</button>
      <button onclick="agregarMaterial()">‚ûï Agregar material</button>
      <button onclick="eliminarMaterial()">üóëÔ∏è Eliminar material</button>
    </div>
  </main>

<script>
/* ---------- CONFIG (ajust√° si quer√©s) ---------- */
const GITHUB_OWNER = 'maurotodisco';
const GITHUB_REPO  = 'Instante.industrial.imagenes';
const GITHUB_BRANCH = 'main';
const REPO_BASE_PATH = ''; // si despu√©s hac√©s carpeta /imagenes/, pon√© 'imagenes'
/* ----------------------------------------------- */

const catalogo = document.getElementById("catalogo");
const editor = document.getElementById("editor");
const materialSelect = document.getElementById("materialSelect");
const descripcionInput = document.getElementById("descripcion");
const nombreMaterialInput = document.getElementById("nombreMaterial");
const imagenSelect = document.getElementById("imagenSelect");

let materiales = [
  { nombre:"Base Met√°lica", descripcion:"Estructura en ca√±o estructural pintado en epoxi en polvo, curado en horno. Color a elecci√≥n.", imagenes:[] },
  { nombre:"Finger de Eucaliptus", descripcion:"Tapa de eucaliptus finger joint, laqueado con poliuretano. Regrueso de 40 mm.", imagenes:[] },
  { nombre:"Enchapado Para√≠so", descripcion:"Tapa enchapada en para√≠so, laqueada con poliuretano. Regrueso de 36 mm.", imagenes:[] },
  { nombre:"Melamina Similmadera", descripcion:"Tapa en melamina similmadera, regrueso de 36 mm.", imagenes:[] }
];

let todasImagenes = [];

/* ---------- Funci√≥n que llama la API de GitHub para listar una carpeta ---------- */
async function listGithubFolder(path) {
  const apiUrl = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${path ? path : ''}?ref=${GITHUB_BRANCH}`;
  const res = await fetch(apiUrl);
  if (!res.ok) {
    console.error('GitHub API error', res.status, await res.text());
    return [];
  }
  const items = await res.json();
  return items;
}

/* ---------- Recorrer recursivamente y recoger archivos de imagen ---------- */
async function fetchAllImages(basePath = REPO_BASE_PATH) {
  const images = [];

  async function walk(path) {
    const items = await listGithubFolder(path);
    for (const item of items) {
      if (item.type === 'dir') {
        await walk(item.path);
      } else if (item.type === 'file') {
        const lower = item.name.toLowerCase();
        if (lower.endsWith('.jpg') || lower.endsWith('.jpeg') || lower.endsWith('.png') || lower.endsWith('.webp') || lower.endsWith('.gif')) {
          const rawUrl = `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/${item.path}`;
          images.push({ name: item.name, path: item.path, url: rawUrl });
        }
      }
    }
  }
  await walk(basePath);
  return images;
}

/* ---------- Inicializaci√≥n: cargar im√°genes desde GitHub ---------- */
async function initFromGithub() {
  const imgs = await fetchAllImages();
  todasImagenes = imgs.map(i => i.url);
  renderCatalogo();
}

function renderCatalogo(){
  catalogo.innerHTML="";
  materiales.forEach(mat=>{
    const div=document.createElement("div");
    div.className="material";
    div.innerHTML=`<h2>${mat.nombre}</h2><p>${mat.descripcion}</p>
      <div class="carousel">${mat.imagenes.map(src=>`<img src="${src}" alt="${mat.nombre}">`).join("")}</div>`;
    catalogo.appendChild(div);
  });
  actualizarSelector();
}

function actualizarSelector(){
  materialSelect.innerHTML="";
  materiales.forEach((mat,i)=>{
    const opt=document.createElement("option");
    opt.value=i; opt.textContent=mat.nombre;
    materialSelect.appendChild(opt);
  });
  if(materiales.length>0) cargarMaterial(0);
}

function cargarMaterial(index){
  if(materiales[index]){
    nombreMaterialInput.value = materiales[index].nombre;
    descripcionInput.value = materiales[index].descripcion;
    imagenSelect.innerHTML = '';
    todasImagenes.forEach((imgUrl, i) => {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = imgUrl.replace(/^.*\/([^\/]+)$/, '$1');
      if (materiales[index].imagenes.includes(imgUrl)) opt.selected = true;
      imagenSelect.appendChild(opt);
    });
  }
}

materialSelect.addEventListener("change", e => {
  cargarMaterial(e.target.value);
});

function guardarCambios(){
  const index = materialSelect.value;
  if (materiales[index]) {
    materiales[index].nombre = nombreMaterialInput.value;
    materiales[index].descripcion = descripcionInput.value;
    const seleccionadas = [...imagenSelect.selectedOptions].map(opt => todasImagenes[opt.value]);
    materiales[index].imagenes = seleccionadas;
    renderCatalogo();
    alert("Cambios guardados");
  }
}

function agregarMaterial(){
  const nuevoNombre = prompt("Nombre del nuevo material:");
  if(!nuevoNombre) return;
  materiales.push({ nombre:nuevoNombre, descripcion:"", imagenes:[] });
  renderCatalogo();
  materialSelect.value = materiales.length - 1;
  cargarMaterial(materiales.length - 1);
}

function eliminarMaterial(){
  const index = materialSelect.value;
  if (!confirm(`¬øSeguro que quer√©s eliminar "${materiales[index].nombre}"?`)) return;
  materiales.splice(index,1);
  renderCatalogo();
  alert("Material eliminado");
}

function toggleEditor(){
  editor.style.display = editor.style.display === "block" ? "none" : "block";
}

initFromGithub().catch(err => {
  console.error('Error inicializando desde GitHub:', err);
  alert('No se pudieron cargar las im√°genes desde GitHub. Revis√° que el repo sea p√∫blico y la ruta sea correcta.');
});
</script>
</body>
</html>
